/**
 * SCHEMA DE PRODUÇÃO — PostgreSQL (Neon)
 *
 * Este arquivo é usado pelo build do Vercel via:
 *   cp prisma/schema.production.prisma prisma/schema.prisma
 *
 * Diferenças do schema.prisma (SQLite):
 *   - provider "postgresql" com directUrl
 *   - price/shippingFreeThreshold: Decimal @db.Decimal(10,2)
 *   - images: String[]
 *   - status: enum OrderStatus
 *   - paymentMethod: enum PaymentMethod
 */

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model SiteUser {
  id                  String    @id @default(uuid())
  username            String    @unique
  email               String    @unique
  passwordHash        String
  role                String    @default("USER")
  active              Boolean   @default(true)
  emailVerified       Boolean   @default(false)
  emailVerifyToken    String?
  emailVerifyTokenExp DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  @@index([username])
  @@index([email])
  @@index([emailVerifyToken])
  @@map("site_users")
}

model UserProfile {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  email     String
  firstName String?
  lastName  String?
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders Order[]
  cart   Cart?

  @@index([clerkId])
  @@map("user_profiles")
}

model Category {
  id       String  @id @default(uuid())
  name     String
  slug     String  @unique
  imageUrl String?

  parentId String?
  parent   Category?  @relation("CategoryChildren", fields: [parentId], references: [id])
  children Category[] @relation("CategoryChildren")

  products Product[]

  @@index([slug])
  @@map("categories")
}

model Product {
  id          String          @id @default(uuid())
  name        String
  slug        String          @unique
  description String
  price       Decimal         @db.Decimal(10, 2)
  stock       Int             @default(0)
  images      String[]        @default([])
  featured    Boolean         @default(false)
  active      Boolean         @default(true)
  ingredients String?
  usage       String?

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  cartItems     CartItem[]
  orderItems    OrderItem[]
  wishlistItems WishlistItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([categoryId])
  @@index([featured])
  @@index([active])
  @@map("products")
}

model Cart {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userProfileId String?      @unique
  userProfile   UserProfile? @relation(fields: [userProfileId], references: [id])
  items         CartItem[]

  @@index([clerkId])
  @@map("carts")
}

model CartItem {
  id        String @id @default(uuid())
  cartId    String
  productId String
  quantity  Int    @default(1)

  cart    Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
  @@map("cart_items")
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentMethod {
  WHATSAPP
  CREDIT_CARD
  PIX
}

model Order {
  id              String        @id @default(uuid())
  status          OrderStatus   @default(PENDING)
  price           Decimal       @db.Decimal(10, 2)
  stripePaymentId String?
  stripeSessionId String?
  cieloPaymentId  String?
  paymentMethod   PaymentMethod @default(WHATSAPP)
  pixQrCode       String?
  customerName    String?
  customerEmail   String?
  customerPhone   String?
  /// JSON: { street, number, complement, city, state, zip }
  shippingAddress String?
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  userProfileId String
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id])
  items         OrderItem[]

  @@index([userProfileId])
  @@index([status])
  @@map("orders")
}

model OrderItem {
  id       String  @id @default(uuid())
  quantity Int
  /// Snapshot do preço no momento da compra
  price    Decimal @db.Decimal(10, 2)

  orderId   String
  productId String
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

/// Configurações globais do site (singleton — id sempre = "default")
model SiteSettings {
  id                   String   @id @default("default")
  siteLogoUrl          String?
  whatsappNumber       String   @default("5511999999999")
  heroTitle            String   @default("Descubra a Verdade da Beleza")
  heroSubtitle         String   @default("Cosméticos de luxo formulados com a pureza da ciência e da natureza")
  heroImageUrl         String?
  heroVideoUrl         String?
  leftVideoUrl         String?
  rightVideoUrl        String?
  heroLogoUrl          String?
  luminaLabel          String   @default("Produto Estrela")
  luminaTitle          String   @default("Descubra o Lumina Sérum")
  luminaSubtitle       String   @default("O sérum que redefiniu o padrão de luminosidade na skincare brasileira. Formulado com Vitamina C estabilizada e extrato de algas douradas.")
  luminaImageUrl       String?
  luminaBadgeText      String   @default("Novo")
  luminaProductLink    String   @default("/products")
  aboutTitle           String   @default("Nossa História")
  aboutText            String   @default("Nascemos da paixão por uma beleza autêntica, sustentável e eficaz. A Altheia foi criada para mulheres que buscam o melhor da natureza aliado à inovação científica.")
  aboutImageUrl        String?
  featuredVideoUrl     String?
  featuredVideoTitle   String   @default("Nossa Jornada")
  featuredVideoDesc    String   @default("Conheça a história por trás de cada produto Altheia")
  instagramUrl         String?
  youtubeUrl           String?
  twitterUrl           String?
  whyTitle             String   @default("Por que Althéia?")
  whySubtitle          String   @default("Qualidade, luxo e eficácia em cada produto.")
  benefit1Icon         String   @default("Truck")
  benefit1Title        String   @default("Frete grátis acima de R$199")
  benefit1Text         String   @default("Entrega em todo o Brasil sem custo adicional.")
  benefit2Icon         String   @default("RotateCcw")
  benefit2Title        String   @default("Devolução em 30 dias")
  benefit2Text         String   @default("Satisfação garantida ou seu dinheiro de volta.")
  benefit3Icon         String   @default("ShieldCheck")
  benefit3Title        String   @default("Pagamento seguro")
  benefit3Text         String   @default("Transações criptografadas e dados protegidos.")
  newsletterTitle      String   @default("Receba Novidades Exclusivas")
  newsletterSubtitle   String   @default("Cadastre-se e ganhe 10% de desconto na primeira compra")
  metaTitle            String?
  metaDescription      String?
  shippingFreeThreshold Decimal @default(199) @db.Decimal(10, 2)
  updatedAt            DateTime @updatedAt

  @@map("site_settings")
}

/// Banco de mídia (imagens e vídeos)
model MediaAsset {
  id        String   @id @default(uuid())
  name      String
  url       String
  /// IMAGE | VIDEO
  type      String   @default("IMAGE")
  size      Int?
  createdAt DateTime @default(now())

  @@map("media_assets")
}

/// Lista de desejos do usuário
model Wishlist {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items WishlistItem[]

  @@index([clerkId])
  @@map("wishlists")
}

model WishlistItem {
  id         String @id @default(uuid())
  wishlistId String
  productId  String

  wishlist Wishlist @relation(fields: [wishlistId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id])

  @@unique([wishlistId, productId])
  @@map("wishlist_items")
}

/// Inscritos na newsletter
model NewsletterSubscriber {
  id          String    @id @default(uuid())
  email       String    @unique
  confirmedAt DateTime?
  createdAt   DateTime  @default(now())

  @@index([email])
  @@map("newsletter_subscribers")
}
